\chapter{Test Procedures}
\label{chap:test}

\section*{3.1.1: Required mode: Idle}
The idle state of the signal source is to be verified by viewing the signal from the
``output'' connector on an oscilloscope. Any signal present must be less than 5~V peak to peak.

The idle state of the detection subsystem is verified by viewing the status annunciators on
the printed circuit board. The annunciator designated ``sample'' must not light.


\section*{3.1.2: Required mode: Analysis}
This requirement is satisfied peripherally by the completion of \hyperref[tp:3.2.6]{requirement 3.2.6}.

\section*{3.2.1: Bode plot}
\label{tp:3.2.1}
\label{tp:3.2.6}
Cause the software to display any data, and verify that it is in the form of a Bode plot.
This means that there should be two plots, both with a horizontal axis of `frequency',
one with a vertical axis of `gain' in decibels, and one with a vertical axis of `phase'
in degrees.

This data can be generated by the instrument (satisfying this requirement peripherally
by the completion of \hyperref[tp:3.2.6]{requirement 3.2.6}), or by any other means.

\section*{3.2.2: Test signal frequency}
\label{tp:3.2.2}
To test this requirement, connect a patch cable between the ``Output'' connector and an oscilloscope
with at least $150$~MHz bandwidth. Either using the PC software or manual control via a serial
terminal, command the instrument to generate signals with frequencies of 1~kHz, 10~MHz, 75~MHz,
and 150~MHz. Using the oscilloscope's frequency display, verify that each signal's frequency is
within 2.5~\% of its nominal value.

\section*{3.2.3: Test signal amplitude}
To test this requirement, connect a patch cable between the ``Output'' connector and an
oscilloscope with at least $300$~MHz bandwidth. Either using the PC software or manual control
via a serial terminal, command the instrument to generate signals with frequencies of
1~kHz, 20~MHz, and 100~MHz, all with maximum amplitude. Using the oscilloscope's amplitude
display, verify that all signals have an amplitude of at least 1.25~V~RMS.

\section*{3.2.4: Sensitivity}
\label{tp:3.2.4}
\begin{enumerate}
\item{Connect a patch cable between ``Output'' and ``Input 1''.}
\item{Command instrument to generate a signal of 100~kHz and maximum amplitude.}
\item{Query reported amplitude.}
\item{Remove patch cable, query reported amplitude. This noise floor must be at least 45~dB
    lower than the amplitude in step 3.}
\item{Reinstall patch cable with a 40~dB attenuator in series. The \Neg 40~dB signal must
    be visible.}
\end{enumerate}

\section*{3.2.5: Extended sensitivity}
To test this optional requirement, perform the same test as in \hyperref[tp:3.2.4]{requirement 3.2.4},
but verify that the final reported amplitude is at least $65\;\mr dB$ lower than the first reported amplitude.

\section*{3.2.6: Accuracy}
\label{tp:3.2.6}

\subsection*{Amplitude}
Connect a pair of patch cables in series using a cable coupler,
and connect this pair between the ``Output'' connector and the ``Input 1'' connector. Configure
the PC software for a full sweep from 1~kHz to 150~MHz not including phase analysis.
Perform normalization. Then, remove the cable coupler and insert a 50~\Ohm{} attenuator with
specified attenuation between 5~dB and 15~dB and bandwidth of at least 200~MHz.
Perform analysis. Verify that the reported gain is within 3~dB of the specified gain of the
attenuator at all frequencies.

\subsection*{Phase}
Connect a patch cable with length under 150~mm between ``Output'' and ``Input 1''.
Configure for a sweep from 10~kHz to 25~MHz, normalize. Using an SMA coupler, add a
patch cable made from 1~m of RG-316 coaxial cable in series. This cable is expected
to exhibit the following phase shift due to propagation delay:

\begin{tabular}{|l|l|}
\hline
Frequency & Phase shift \\ \hline \hline
10~kHz & 0.02\dg \\ \hline
1~MHz & 1.74\dg \\ \hline
10~MHz & 17.4\dg \\ \hline
25~MHz & 43.5\dg \\ \hline
\end{tabular}

Ensure that the propagation delay reported is within 5\dg{} of this at these frequencies.

\section*{3.2.7: Extended accuracy}
To test this optional requirement, perform the test for \hyperref[tp:3.2.6]{requirement 3.2.6},
with the following modifications: the upper sweep limit should be $20$~MHz, reported gain must be
within $1$~dB of the specified attenuator gain, and phase shift must be within $1\dg$ of zero
(above $-1\dg$ and below $+1\dg$) at all frequencies.

\section*{3.2.8: Interface safety}
\label{tp:3.2.8}
To test this requirement, use the interface control commands to attempt to set a GPIO pin
which serves as a signal input to be an output instead. The system must respond with an error.

\section*{3.3.1: Interface}
This requirement is satisfied peripherally by the completion of requirements \hyperref[tp:3.2.1]{3.2.1}
through \hyperref[tp:3.2.8]{3.2.8}, which all required PC interfacing to complete.

\section*{3.3.2: Communications type}
\label{tp:3.3.2}
To test this requirement, connect the instrument to a PC. Connect a serial terminal application
to it, and perform at least one command that produces a response. Demonstrate that the
command and response comprise displayable text symbols.

\section*{3.3.3: Communications medium}
This requirement is demonstrated peripherally as part of demonstrating
\hyperref[tp:3.3.2]{requirement 3.3.2}: the ability for a standard serial console
to talk to the instrument demonstrates that the instrument was using a standard
protocol.

\section*{3.3.4: Panel connectors}
To test this requirement, observe the front panel of the device, and see that the RF connectors are either
SMA or BNC.

\section*{3.3.5: Auxiliary connector}
Using a multimeter, measure all pins on the ``Auxiliary'' connector, verifying that there are
power supply pins with a voltage present of at least \Pos 7~V and \Neg 7~V.
$-7\;\mr V$. Then, switch the multimeter to ammeter mode, and connect in series a selected resistor. Probe
these pins again, and verify that at least $40\;\mr mA$ is supplied.

The resistor is to be selected such that it will draw at least $40\;\mr mA$ at the voltage that was
measured on the connectors. This resistance may depend on the actual voltage that was present,
which is allowed to be \emph{above} the required $\pm 7\;\mr V$.

\section*{3.6.1: Operator's Manual}
Demonstrate the existence of a manual in digital format, containing at least the following
sections: Theory of Operation, Operational Instructions. Demonstrate that there exist example
test setups for characterization of filters and of control loops.

\section*{3.6.2: Protocol Guide}
Demonstrate the existence of documentation explaining the protocol with which a PC communicates with the
instrument. This documentation may be part of the Operator's Manual, or it may be separate.

\section*{3.6.3: SMT}
Demonstrate that the parts on the PCB are surface-mount devices, with the following allowed
exceptions:
\begin{itemize}
\item{Connectors: through-hole connections have higher mechanical stability}
\item{Inductors and capacitors larger than $5\;\mr{mm}$ in diameter: through-hole parts have higher mechanical stability}
\end{itemize}

Demonstrate that the only leadless devices on the PCB are essential for its function. This may be
a result of directly satisfying an above requirement. An anticipated example is device \refdes{U3},
an Analog Devices AD9958BCPZ digital frequency synthesizer, which directly satisfies
\hyperref[tp:3.2.2]{requirement 3.2.2} (test signal frequency between $1\;\mr{kHz}$ and $150\;\mr MHz$).

\section*{3.6.4: Direct control}
Viewing the protocol guide, demonstrate the existence of:

\begin{itemize}
\item{A command to set the output value of an arbitrary GPIO pin.}
\item{A command to query the input value of an arbitrary GPIO pin.}
\item{A command to transmit arbitrary data via the on-board SPI interface.}
\item{A command to query the direct output value of the analog-to-digital converter.}
\end{itemize}

\section*{3.6.5: Electrical safety}
To test this requirement, connect the ``common'' input of a multimeter to the instrument ground, and
verify that no signals on the ``Auxiliary'' connector are more positive than $15$~V or more negative than $-15$~V.
Then, connect a patch cable between the ``Output'' connector and an oscilloscope. Do not terminate the end. Command
the instrument to generate a frequency of $100$~kHz and maximum amplitude. Using the oscilloscope's amplitude display,
verify that the positive and negative peaks are no more positive than $15$~V and no more negative than
$-15$~V.
